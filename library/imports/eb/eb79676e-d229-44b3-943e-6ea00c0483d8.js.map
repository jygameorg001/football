{"version":3,"sources":["assets\\Script\\common\\EventManager.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AACA,SAAgB,SAAS;IACrB;QAOI;QAAyB,CAAC;QAJ1B,sBAAW,0BAAQ;iBAAnB;gBACI,OAAO,CAAC,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC,CAAM,CAAC;YAClE,CAAC;;;WAAA;QAJc,wBAAS,GAAmB,IAAI,CAAC;QAOpD,qBAAC;KARD,AAQC,IAAA;IAED,OAAO,cAAc,CAAC;AAC1B,CAAC;AAZD,8BAYC;AAMD;IAAkC,gCAAyB;IAA3D;QAAA,qEAoJC;QAnJW,YAAM,GAA6B,IAAI,GAAG,EAAE,CAAC;;IAmJzD,CAAC;IAjJG;;;;;OAKG;IACH,yBAAE,GAAF,UAAG,KAAa,EAAE,QAAkB,EAAE,MAAgB;QAClD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;YACzB,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;SAC9B;QAED,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAElC,KAAiB,UAAI,EAAJ,aAAI,EAAJ,kBAAI,EAAJ,IAAI,EAAE;YAAlB,IAAI,IAAI,aAAA;YACT,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,EAAE;gBACxB,OAAO;aACV;SACJ;QAED,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,OAAA,EAAE,QAAQ,UAAA,EAAE,MAAM,QAAA,EAAE,CAAC,CAAC;IAC3C,CAAC;IAED;;;;;OAKG;IACH,0BAAG,GAAH,UAAI,KAAa,EAAE,QAAkB,EAAE,MAAgB;QACnD,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;YACxB,IAAM,KAAK,GAAG,IAAI,CAAC,MAAM;iBACpB,GAAG,CAAC,KAAK,CAAC;iBACV,SAAS,CAAC,UAAC,CAAC,IAAK,OAAA,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,KAAK,QAAQ,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,EAAnF,CAAmF,CAAC,CAAC;YAC3G,KAAK,GAAG,CAAC,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YAEtD,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;gBACrC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;aAC7B;SACJ;IACL,CAAC;IAED;;;;OAIG;IACH,2BAAI,GAAJ,UAAK,KAAa;QAAE,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,6BAAc;;QAC9B,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;YACxB,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,UAAC,EAAoB;oBAAlB,QAAQ,cAAA,EAAE,MAAM,YAAA;gBAC9C,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,eAAI,IAAI,CAAC,CAAC;YAC9D,CAAC,CAAC,CAAC;SACN;IACL,CAAC;IAEG;;;;GAID;IACH,mCAAY,GAAZ,UAAa,KAAa;QAAE,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,6BAAc;;QACtC,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;YACxB,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAClC,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,EAAI;gBACpB,oCAAoC;gBACpC,OAAO;aACV;YACD,IAAI,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;YAC5B,IAAI,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;YAChC,OAAO,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,eAAI,IAAI,CAAC,CAAC;SACpE;IACL,CAAC;IAED;;;OAGG;IACH,4BAAK,GAAL,UAAM,KAAc;QAApB,iBAUC;QATG,IAAI,CAAC,KAAK,EAAE;YACR,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,IAAI,EAAE,KAAK;gBAC5B,KAAiB,UAAI,EAAJ,aAAI,EAAJ,kBAAI,EAAJ,IAAI,EAAE;oBAAlB,IAAI,IAAI,aAAA;oBACT,KAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;iBAC/C;YACL,CAAC,CAAC,CAAC;SACN;aAAM;YACH,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;SAC7B;IACL,CAAC;IAED;;;OAGG;IACH,oCAAa,GAAb,UAAc,MAAe;QAA7B,iBAQC;QAPG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,IAAI,EAAE,KAAK;YAC5B,KAAiB,UAAI,EAAJ,aAAI,EAAJ,kBAAI,EAAJ,IAAI,EAAE;gBAAlB,IAAI,IAAI,aAAA;gBACT,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,EAAE;oBACxB,KAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;iBAC/C;aACJ;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;OAEG;IACH,gCAAS,GAAT;QAAA,iBAgBC;QAfG,IAAI,SAAS,GAAa,EAAE,CAAC;QAE7B,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,IAAI,EAAE,KAAK;YAC5B,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,UAAC,CAAC,IAAK,OAAA,CAAC,CAAC,QAAQ,CAAC,IAAI,KAAK,EAAE,EAAtB,CAAsB,CAAC,CAAC;YAElD,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;gBACjB,KAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;aAChC;iBAAM;gBACH,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACzB;QACL,CAAC,CAAC,CAAC;QAEH,SAAS,CAAC,OAAO,CAAC,UAAC,KAAK;YACpB,KAAI,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC9B,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;OAEG;IACH,2BAAI,GAAJ;QACI,IAAI,KAAK,GAAG,CAAC,CAAC;QAEd,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,IAAI;YACrB,IAAI,CAAC,OAAO,CAAC,UAAC,CAAC;gBACX,KAAK,EAAE,CAAC;YACZ,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IAEP,CAAC;IAED;;;;OAIG;IACH,uCAAgB,GAAhB,UAAiB,KAAa;QAC1B,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAClC,CAAC;IACL,mBAAC;AAAD,CApJA,AAoJC,CApJiC,SAAS,EAAgB,GAoJ1D;AApJY,oCAAY;AAsJZ,QAAA,QAAQ,GAAG,YAAY,CAAC,QAAQ,CAAC","file":"","sourceRoot":"/","sourcesContent":["\r\nexport function Singleton<T>() {\r\n    class SingletonClass {\r\n        private static _instance: SingletonClass = null;\r\n\r\n        static get instance(): T {\r\n            return (this._instance || (this._instance = new this())) as T;\r\n        }\r\n\r\n        protected constructor() {}\r\n    }\r\n\r\n    return SingletonClass;\r\n}\r\nexport interface EventData {\r\n    event?: string;\r\n    listener: Function;\r\n    target?: any;\r\n}\r\nexport class EventManager extends Singleton<EventManager>() {\r\n    private events: Map<string, EventData[]> = new Map();\r\n\r\n    /**\r\n     * 监听事件\r\n     * @param event\r\n     * @param listener\r\n     * @param target\r\n     */\r\n    on(event: string, listener: Function, target?: unknown) {\r\n        if (!this.events.has(event)) {\r\n            this.events.set(event, []);\r\n        }\r\n\r\n        let list = this.events.get(event);\r\n\r\n        for (let item of list) {\r\n            if (item.target === target) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        list.push({ event, listener, target });\r\n    }\r\n\r\n    /**\r\n     * 注销事件\r\n     * @param event\r\n     * @param listener\r\n     * @param target\r\n     */\r\n    off(event: string, listener: Function, target?: unknown) {\r\n        if (this.events.has(event)) {\r\n            const index = this.events\r\n                .get(event)\r\n                .findIndex((v) => (!!listener ? v.listener === listener && v.target === target : v.target === target));\r\n            index > -1 && this.events.get(event).splice(index, 1);\r\n\r\n            if (this.events.get(event).length === 0) {\r\n                this.events.delete(event);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 派发事件\r\n     * @param event\r\n     * @param args\r\n     */\r\n    emit(event: string, ...args: any[]) {\r\n        if (this.events.has(event)) {\r\n            this.events.get(event).forEach(({ listener, target }) => {\r\n                target ? listener.apply(target, args) : listener(...args);\r\n            });\r\n        }\r\n    }\r\n\r\n        /**\r\n     * 派发事件\r\n     * @param event\r\n     * @param args\r\n     */\r\n    emitCallBack(event: string, ...args: any[]):any {\r\n        if (this.events.has(event)) {\r\n            let list = this.events.get(event);\r\n            if (list.length != 1)   {\r\n                // console.warn(\"监听接口超过一个，不能调用这个接口\")\r\n                return;\r\n            }\r\n            let target = list[0].target;\r\n            let listener = list[0].listener;\r\n            return target ? listener.apply(target, args) : listener(...args);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清空事件map\r\n     * @param event\r\n     */\r\n    clear(event?: string) {\r\n        if (!event) {\r\n            this.events.forEach((list, event) => {\r\n                for (let item of list) {\r\n                    this.off(event, item.listener, item.target);\r\n                }\r\n            });\r\n        } else {\r\n            this.events.delete(event);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 删除target所有事件\r\n     * @param target\r\n     */\r\n    clearByTarget(target: unknown) {\r\n        this.events.forEach((list, event) => {\r\n            for (let item of list) {\r\n                if (item.target === target) {\r\n                    this.off(event, item.listener, item.target);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 清空所有匿名函数事件\r\n     */\r\n    clearAnon() {\r\n        let clearList: string[] = [];\r\n\r\n        this.events.forEach((list, event) => {\r\n            list = list.filter((v) => v.listener.name !== \"\");\r\n\r\n            if (list.length > 0) {\r\n                this.events.set(event, list);\r\n            } else {\r\n                clearList.push(event);\r\n            }\r\n        });\r\n\r\n        clearList.forEach((event) => {\r\n            this.events.delete(event);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 打印事件\r\n     */\r\n    dump() {\r\n        let count = 0;\r\n\r\n        this.events.forEach((list) => {\r\n            list.forEach((v) => {\r\n                count++;\r\n            });\r\n        });\r\n\r\n    }\r\n\r\n    /**\r\n     * 获取事件所有监听\r\n     * @param event\r\n     * @returns\r\n     */\r\n    getEventDataList(event: string) {\r\n        return this.events.get(event);\r\n    }\r\n}\r\n\r\nexport const EventMgr = EventManager.instance;\r\n"]}